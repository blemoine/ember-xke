<script type="text/x-handlebars" data-template-name="tutorial-app">
    <div id="header">
        <img src="img/tuto-header.png"/>
        <h2>Tutoriel</h2>
    </div>
    <div class="steps">
        {{#each step in Tuto.STEPS}}
            {{view Tuto.StepView stepBinding=step}}
        {{/each}}
    </div>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step">
    <div class="step-title" {{action toggleDetail target="view"}}>
        {{unbound step.title}}
        <span class="vline a"></span>
        <span class="picto"></span>
        <span class="vline b"></span>
    </div>
    <div {{bindAttr class=":step-detail :well view.detailIsShown:solShown:solHidden"}}>

        <h4>Explications</h4>
        {{view view.explanationView}}

        <h4>Que manque t'il ?</h4>
        <div class="well">
            {{step.errors}}
        </div>
        <button class="btn btn-success" type="button" {{action toggleSolution target="view"}}>Solution<span class="caret"></span></button>

        <div {{bindAttr class=":solution view.solutionIsShown:solShown:solHidden"}}>
            {{view view.solutionView}}
        </div>
    </div>

</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-empty">
    Pas détail, débrouille toi !
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-empty">
    Pas de solution
</script>



<script type="text/x-handlebars" data-template-name="tutorial-step-app">
    <p>Il était une fois un petit Poney-Licorne nommé Raymond qui cherchait désespérément à construire une application
    Ember, malheureusement il ne trouvait personne pour l'aider.
    </p>

    <p>
    Allez dans le fichier App.js, et créez un objet 'App' de type Ember.Application et précisez que son
    élement racine est ember-app
    </p>

    <a href="http://emberjs.com/guides/application" target="_blank">Documentation du concept d'application</a>
    <br />
    <a href="http://emberjs.com/api/classes/Ember.Application.html" target="_blank">API de Ember.Application, cf. rootElement</a>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-app">
    App = Ember.Application.create({
        rootElement: '#ember-app'
    });
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-hello">
    <p>Votre application Ember est créée, mais vous n'avez définie aucune interface. </p>

    <p>Créez un nouveau template <strong>application</strong> avec une balise <code>h1</code> content le texte <strong>My Li'l Pony Application</strong> </p>

    <a href="http://emberjs.com/guides/application/the-application-template" target="_blank">Documentation du template d'application</a>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-hello">
    &#8249;script type="text/x-handlebars" data-template-name="application">
        <h1>My Li'l Pony Application</h1>
    &#8249;/script>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-ds">
    <p>Il va maintenant être nécessaire de créer une classe pour représenter votre Poney. Pour cela, nous allons utiliser <a href="https://github.com/emberjs/data">Ember-Data</a>.
        Attention, Ember-data reste une librairie en cours de développement. </p>

    <p> La première étape va être de configurer un store : <a href="http://emberjs.com/guides/models/defining-a-store">créer un store</a>.</p>

</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-ds">
    App.Store = DS.Store.extend({
        revision: 12
    });
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-model">
    <p> Ensuite, il va falloir définir une classe <strong>App.Pony</strong>,  avec 4 propriétés de type String&nbsp;:
        <strong>firstName</strong>, <strong>lastName</strong>, <strong>color</strong>, <strong>type</strong></p>

    <a href="http://emberjs.com/guides/models/defining-models">Définition des modèles</a>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-model">
    App.Poney = DS.Model.extend({
        lastName: DS.attr('string'),
        firstName: DS.attr('string'),
        color: DS.attr('string'),
        type: DS.attr('string'),
        name: function () {
            return this.get('firstName') + ' ' + this.get('lastName');
        }.property('firstName', 'lastName')
    });
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-fixture">
    <p>Afin de préparer l'alimentation d'une liste de poneys, nous utilisons des données bouchonnées par Ember Data. Ce bouchon se nomme <strong>fixture</strong>.</p>
    <p>Indiquez au datastore que vous souhaitez utiliser un adapter de type <strong>DS.FixtureAdapter</strong> (cf <a href="http://emberjs.com/guides/models/defining-a-store">la partie concernant l'adapter</a></p>
    <p>Puis dans une propriété statique nommée FIXTURES de la classe App.Poney, ajouter le tableau contenant la liste de vos poneys&nbsp;: </p>
    <pre class="brush: js">
        App.Poney.FIXTURES = [
    {
        id: 1,
        firstName: 'Rainbow',
        lastName: 'Dash',
        color: 'Sky blue',
        type: 'Pegasus'
    },
    {
        id: 2,
        firstName: 'Twillight',
        lastName: 'Sparkle',
        color: 'Lavender',
        type: 'Alicorn'
    },
    {
        id: 3,
        firstName: 'Apple',
        lastName: 'Jack',
        color: 'orange',
        type: 'Earth Pony'
    }
];
    </pre>

</script>


<script type="text/x-handlebars" data-template-name="tutorial-solution-fixture">
     <pre class="brush: js">
        App.Store = DS.Store.extend({
            revision: 12,
            adapter: 'DS.FixtureAdapter'
        });

        App.Poney.FIXTURES = [
    {
        id: 1,
        firstName: 'Rainbow',
        lastName: 'Dash',
        color: 'Sky blue',
        type: 'Pegasus'
    },
    {
        id: 2,
        firstName: 'Twillight',
        lastName: 'Sparkle',
        color: 'Lavender',
        type: 'Alicorn'
    },
    {
        id: 3,
        firstName: 'Apple',
        lastName: 'Jack',
        color: 'orange',
        type: 'Earth Pony'
    }
];
    </pre>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-list">

    <p>Par convention, sur la route <strong>/</strong> Ember rend la propriété Index (cf <a href="http://emberjs.com/guides/routing/defining-your-routes/">les conventions sur les routes</a>.
    Vous devez donc maintenant définir une route <strong>App.IndexRoute</strong>, dont le modèle associé sera la liste des poneys renvoyés par la fixture.</p>
    <a href="http://emberjs.com/guides/routing/specifying-a-routes-model/">Pour définir une route (il n'y a pas besoin de définir de router pour l'instant, tout se fait par convention)</a>
    <br />
    <a href="http://emberjs.com/guides/models/finding-models/">Pour récupérer la liste des poneys depuis le modèle</a>
    <p>Nous allons maintenant afficher la liste des poneys dans la page. Pour cela il faut ajout une balise <a href="http://emberjs.com/api/classes/Ember.Handlebars.helpers.html#method_outlet">outlet</a> au template application,
        outlet qui nous servira de placeholder indiquand ou sera inséré la liste des poneys.</p>
    <p>Enfin, il faut créer un nouveau template nommé <strong>index</strong>. Par convention, le modèle renvoyé par la route est chargé dans une propriété nommé <strong>content</strong> dans le controller.
       Ici, la liste des poneys est donc accessible dans le template depuis la propriété content.
        Afficher la liste des prénoms de poneys dans le template index à l'aide de balise &lt;ul&gt; et &lt;li&gt;.
    </p>

    <a href="http://emberjs.com/guides/templates/displaying-a-list-of-items/">Affiche une liste d'éléments dans un template</a>

</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-list">
App.IndexRoute = Ember.Route.extend({
    model: function () {
       return App.Pony.find();
    }
});

&#8249;script type="text/x-handlebars" data-template-name="application">
  <h1>My Li'l Pony Application</h1>
  \{{outlet}}
&#8249;/script>

&#8249;script type="text/x-handlebars" data-template-name="index">
<ul>
  \{{#each poney in content}}
    <li>\{{poney.firstName}}</li>
  \{{/each}}
</ul>
&#8249;/script>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-computed">
    <p>Plutôt que d'afficher simplement la liste des prénoms, nous allons maintenant afficher la liste des noms complet (prénom et nom) des poneys. Pour cela, nous allons déclarer
    une propriété calculé <strong>name</strong> dans la classe App.Poney . Les <a href="http://emberjs.com/guides/object-model/computed-properties/">propriétés calculées</a>
        sont des propriétés accessibles sur les objets Ember, dont la valeur est dépendant d'autres propriétés du même objet.
    </p>
    <p>La propriété calculé name doit être la concaténation du prénom et du nom, séparé par un espace. Afficher ensuite cette propriété à la place du prénom dans la liste des poneys.</p>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-computed">
App.Pony = DS.Model.extend({
    firstName: DS.attr('string'),
    lastName: DS.attr('string'),
    color: DS.attr('string'),
    type: DS.attr('string'),
    name: function () {
       return this.get('firstName') + ' ' + this.get('lastName');
    }.property('firstName', 'lastName')
});

&#8249;script type="text/x-handlebars" data-template-name="index">
<ul>
    \{{#each poney in content}}
    <li>\{{poney.name}}</li>
    \{{/each}}
</ul>
&#8249;/script>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-consultation">
    <p>Nous allons maintenant créer une page de consultation pour chaque poney. Pour cela, nous allons devoir créer une route, un template correspondant à la page de consultation
        et un lien pour atteindre cette page.</p>

    <p> Tout d'abord, nous allons créer une route nommée <strong>detail</strong>, ayant pour path <strong>/pony/:pony_id</strong>. </p>
    <a href="http://emberjs.com/guides/routing/defining-your-routes/">Déclaration d'une route</a>
    <p>Par convention, Ember cherche un template correspondant au nom de la route pour l'insérer dans l'outlet application. Par ailleurs, toujours par convention,
        Ember appelle la méthode App.Pony.find(pony_id) si le paramètre de path se nomme pony_id. Nous n'avons donc ici pas besoin de définir de route pour charger le modèle.</p>

    <p>Définissez ensuite un template nommé <strong>detail</strong>, dans lequel vous afficherez le nom complet, le type et la couleur du poney choisi.</p>

    <p>Enfin, utilisez le helper <a href="http://emberjs.com/guides/templates/links/">linkTo</a> pour créer un lien vers le détail. </p>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-consultation">
App.Router.map(function () {
  this.route('detail', {path: 'pony/:pony_id'});
});

&#8249;script type="text/x-handlebars" data-template-name="index">
    <span>Name: \{{content.name}}</span><br/>
    <span>Color: \{{content.color}}</span><br/>
    <span>Type: \{{content.type}}</span><br/>
&#8249;/script>

&#8249;script type="text/x-handlebars" data-template-name="index">
<ul>
    \{{#each poney in content}}
    <li>\{{#linkTo detail poney}}\{{poney.name}}\{{/linkTo}}</li>
    \{{/each}}
</ul>
&#8249;/script>

</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-home">
    <p>Créez maintenant un lien sur le titre de l'application pour retourner à la home page. Par convention, la home page se nomme index.</p>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-solution-home">
&#8249;script type="text/x-handlebars" data-template-name="application">
    <h1>\{{#linkTo index}}My Li'l Pony Application\{{/linkTo}}</h1>
    \{{outlet}}
&#8249;/script>
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-add">
    <p>Il est maintenant nécessaire de pouvoir ajouter de nouveaux poneys. Pour cela, nous allons créer une route, un controller et un template.</p>

    <p>Tout d'abord, il faut créer la route add, permettant d'arriver sur la page d'ajout. Par convention, si aucun path n'est spécifier l'url de la route se déduit de son nom.</p>
    <a href="http://emberjs.com/guides/routing/defining-your-routes/">Rappel sur la création de route</a>

    <p>Nous allons maintenant créer le template <strong>add</strong> avec un formulaire. Ember fournit des composants permettant de gérer le binding sur les formulaires, nous allons donc
    utiliser ceux-ci. Créer un formulaire avec 4 label et 4 champs input text en utilisant <a href="http://emberjs.com/blog/2013/04/21/ember-1-0-rc3.html">la syntaxe de formulaire de la RC.3</a></p>

    <p>Pour que nos propriétés soient enregistrés dans un objet avant d'être synchronisé par Ember Data, il faut créer cet objet au niveau du controller.
        Une solution pour cela est d'indiqué que le model correspondant à notre route est un objet simple contenant simplement une propriété id préremplie, ie :
    <code>{id: new Date().getTime()}</code>. Créer la route <strong>App.AddRoute</strong> et dans sa méthode modèle, renvoyé l'objet précréé.</p>

    <p>Il ne reste plus qu'à créer un bouton dans le formulaire qui enregistrera effectivement le poney dans le store. Pour cela ajoutez un <strong>input type="submit"</strong>
        à votre formulaire, utilisez un helper <a href="http://emberjs.com/guides/templates/actions/">action</a> pour appeler une méthode <strong>savePoney</strong>. </p>
    <p>Créer un controller <strong>App.AddController</strong> héritant de <code>Ember.ObjectController</code>, et créez une méthode savePoney dans celui-ci.
        C'est cette méthode qui est appelée par le bouton. Les champs du formulaire sont synchronisé en temps réel au fur et à mesure de la frappe&nbsp;; la méthode savePoney
        peut donc se contenter d'enregistrer l'attribut <code>content</code> du controller dans le datastore.
    </p>

    <p>Pour accéder au content du controller, vous pouvez utilisez la méthode <code>this.get('content')</code>.
        Pour enregistrer votre modèle, vous devez utiliser la fonction <code>createRecord</code>, ie&nbsp;:
        <code>App.Pony.createRecord(this.get('content'));</code>
    </p>

    <p>Enfin, une fois le poney enregistré dans le datastore, on souhaite rediriger vers l'accueil. Pour cela, le controller possède
        une méthode <a href="http://emberjs.com/api/classes/Ember.Controller.html#method_transitionToRoute">transitionToRoute</a> prenant en paramètre
    le  nom de la route vers laquelle on désire être redirigé.</p>

</script>
<script type="text/x-handlebars" data-template-name="tutorial-solution-add">
App.Router.map(function () {
    this.route('detail', {path: 'pony/:pony_id'});
    this.route('add');
});

App.AddRoute = Ember.Route.extend({
  model: function () {
    return {id: new Date().getTime()};
  }
});

App.AddController = Ember.ObjectController.extend({
  savePony: function () {
    App.Pony.createRecord(this.get('content'));
    this.transitionToRoute('index');
  }
});
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-rest">
    <p>Plutôt que d'utiliser un bouchon, on peut maintenant se brancher directement sur le serveur pour persister les poneys que l'on créé.
      Pour cela, changez d'adapter dans le store et utiliser le <a href="http://emberjs.com/guides/models/the-rest-adapter/">le REST adapter</a>.
    </p>

    <p>Par ailleurs, pour synchroniser le store avec le serveur, il est nécessaire de commiter les modifications. Pour cela,
        appelez la méthode <code>this.get('store').commit();</code> juste avant la rédirection dans la méthode <code>savePony</code>
    </p>

</script>
<script type="text/x-handlebars" data-template-name="tutorial-solution-rest">
App.Store = DS.Store.extend({
    revision: 12,
    adapter: 'DS.RESTAdapter'
});

App.AddController = Ember.ObjectController.extend({
  savePony: function () {
    App.Pony.createRecord(this.get('content'));
    this.get('store').commit();
    this.transitionToRoute('index');
  }
});
</script>

<script type="text/x-handlebars" data-template-name="tutorial-step-helper">
    <p>Enfin nous allons créer un <a href="http://emberjs.com/guides/templates/writing-helpers/">helper</a>, permettant d'afficher le nom du poney en majuscule dans la consultation. </p>
    <p>Créez le helper <strong>upperCase</strong> et utilisez le sur le nom dans la consultation</p>
</script>
<script type="text/x-handlebars" data-template-name="tutorial-solution-helper">
Ember.Handlebars.registerBoundHelper('upperCase', function (text) {
    return text.toUpperCase();
});

&#8249;script type="text/x-handlebars" data-template-name="index">
    <span>Name: \{{upperCase content.name}}</span><br/>
    <span>Color: \{{content.color}}</span><br/>
    <span>Type: \{{content.type}}</span><br/>
&#8249;/script>

</script>